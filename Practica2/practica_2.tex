\part{Práctica 2}
\section{Actividad 2-1}
\label{p21}
\begin{center}
    \parbox{12cm}{\justify\textit{Para esta práctica, utilice el conjunto de datos de altura de ola proporcionado en Moodle.\\
    Describa las operaciones de preprocesamiento que ha realizado sobre la base de datos proporcionada y cómo queda la base de datos final ya preprocesada. Se deja a su elección el conjunto de técnicas a aplicar, así como el nivel de detalle y descripción que quiera dar a su trabajo. \\   
    Para probar rendimientos sobre su preprocesamiento, puede lanzar cualquier algoritmo de Weka, por ejemplo classifiers.functions.Logistic, y fijarse en la métrica ``Correctly Classified Instances''. En la opción ``Suplied test set'' se indicaría el fichero del conjunto de test, mientras que el de entrenamiento corresponde al que se ha cargado desde la pestaña Preprocess.}}
\end{center}

\subsection{Introducción}
En este ejercicio se van a poner en práctica los conceptos aprendidos sobre preprocesamiento de datos. Para ello se utilizará una base de datos de observaciones meteorológicas tomadas entre 2014 y 2016 a razón de 4 mediciones al día. El conjunto tiene 3559 patrones con 17 atributos numéricos y una clase nominal. Los atributos son:
\begin{itemize}
    \item AIR: Temperatura del aire en la superficie (ºK).
    \item PRES: Presión a nivel de superficie (Pa).
    \item RHUM: Humedad relativa a nivel de superficie (\%).
    \item UWND: Velocidad del viento de oeste a este (eje X) (m/s).
    \item VWND: Velocidad del viento de sur a norte (eje Y) (m/s).
    \item WDIR: Dirección del viento en el sentido de las agujas del reloj (grad).
    \item WSPD: Velocidad del viento (m/s).
    \item GST: Velocidad de pico del viento (m/s).
    \item DPD: Periodo de ola dominante (s).
    \item APD: Periodo medio de ol a dominante (s).
    \item MWD: Dirección de la que viene el periodo de ola dominante (grad).
    \item PRES: Presión a nivel de superficie (HPa).
    \item ATMP: Temperatura del aire en la parte superior de la boya (ºC).
    \item WTMP: Temperatura a nivel del mar (ºC).
    \item DEWP: Punto de rocío tomado a la misma altura que ATMP (ºC).
    \item VIS: Visibilidad desde la boya (MN).
    \item TIDE: NIvel del agua por encima o por debajo de la media inferior del agua (Pies).
\end{itemize}
La variable de salida indica la altura de ola en las seis horas siguientes. Es discreta con valores Baja, Media, Moderada y MuyAlta.

Para valorar el preprocesamiento realizado, se generará a cada paso un clasificador logístico y se evaluará con un conjunto de pruebas con la misma estructura que contiene los datos correspondientes a los años 2017 y 2018. Este proceso se realiza desde la pestaña Classify de Weka Explorer. El clasificador seleccionado será Functions.Logistic con la configuración indicada en la figura \ref{fig:classifiers-functions-logistic-config} y utilizando como conjunto de test el archivo \code{alturaolatest.arff}, al que previamente se le habrá realizado el correspondiente tratamiento.

\begin{figure}[ht]
    \centering
    \includegraphics[scale=0.4]{classifiers-functions-logistic-config}
    \caption{Configuración del clasificador logístico}
    \label{fig:classifiers-functions-logistic-config}
\end{figure}

\subsection{Preparación}
Como paso previo se han convertido los archivos \code{.csv} a \code{.arff}. Los dos archivos se han cargado en Weka para poder visualizar su contenido, como puede verse en las figuras \ref{fig:altura-ola-orig} y \ref{fig:altura-ola-test-orig}.

\begin{figure}[H]
    \centering
    \begin{minipage}{0.5\textwidth}
        \centering
        \includegraphics[scale=0.29]{altura-ola-orig}
        \caption{Captura de \code{alturaola.arff}.}
        \label{fig:altura-ola-orig}
    \end{minipage}\hfill
    \begin{minipage}{0.5\textwidth}
        \centering
        \includegraphics[scale=0.29]{altura-ola-test-orig}
        \caption{Captura de \code{alturaolatest.arff}.}
        \label{fig:altura-ola-test-orig}
    \end{minipage}
\end{figure}

Tras la conversión de los archivos y antes de empezar el tratamiento de los datos, se ha generado y testeado el clasificador logístico para ver el punto de partida. En la figura \ref{fig:clasificador-logistico-resultados-00} se pueden observar los resultados: se tiene en el punto de partida un $71.9335\%$ de patrones correctamente clasificados y precisión mínima de $0.660$ para la clase ``Media''.

\begin{figure}[ht]
    \centering
    \includegraphics[scale=0.8]{clasificador-logistico-resultados-00}
    \caption{Resultados del clasificador logístico antes del tratamiento de datos.}
    \label{fig:clasificador-logistico-resultados-00}
\end{figure}

\subsection{Datos perdidos}
En primer lugar se eliminan los tres atributos con 100\% de datos perdidos: TIDS, VIS y MWD tanto en el conjunto de entrenamiento como en el de test y se genera de nuevo el clasificador logístico. Como se puede observar en la figura \ref{fig:clasificador-logistico-resultados-01}, la eliminación de los atributos con 100\% de datos perdidos no tiene ningún efecto.

\begin{figure}[ht]
    \centering
    \includegraphics[trim={0cm 10.4cm 7cm 0.7cm},clip]{clasificador-logistico-resultados-01}
    \caption{Resultados tras eliminar TIDS, VIS y MWD.}
    \label{fig:clasificador-logistico-resultados-01}
\end{figure}

A continuación se estudian los campos con valores perdidos que son en entrenamiento DPD, APD, PRES y DEWP con 8 (<1\%), 8 (<1\%), 553 (16\%) y 1189 (33\%) patrones con datos perdidos respectivamente y en pruebas WSPD, GST, DPD, APD, PRES, ATMP, WTMP Y DEWP . Para estos casos se reemplazan los valores perdidos por la media de la clase calculada sobre el conjunto de entrenamiento tanto en el conjunto de entrenamiento como en el conjunto de generalización (ver cuadro \ref{tab:medias-por-clase}). Se realiza este procedimiento siguiendo el consejo del archivo \code{Imputación de valores perdidos mas justa en training y test.pdf}, aunque me preocupa en qué medida contribuirá al rendimiento del modelo cuando se exponga a datos nuevos.

\begin{table}[ht]
    \centering
    \begin{tabular}{|r|rlrl|rrrr|}
    \hline
      \multicolumn{1}{|c|}{} &
      \multicolumn{4}{c|}{Datos perdidos} &
      \multicolumn{4}{c|}{Medias en entrenamiento} \\
      \multicolumn{1}{|c|}{Atributo} &
      \multicolumn{2}{c}{Entrenamiento} &
      \multicolumn{2}{c|}{Test} &
      \multicolumn{1}{c}{Baja} &
      \multicolumn{1}{c}{Media} &
      \multicolumn{1}{c}{Moderada} &
      \multicolumn{1}{c|}{MuyAlta} \\ \hline
      WSPD & 0    & (0\%)  & 1    & (<1\%)  & 4,6    & 6,6    & 8,4    & 11,9   \\ 
      GST  & 0    & (0\%)  & 9    & (<1\%)  & 5,6    & 8,1    & 10,5   & 14,9   \\
      DPD  & 8    & (<1\%) & 21   & (1\%)   & 11,5   & 10,3   & 10,8   & 11,7   \\
      APD  & 8    & (<1\%) & 21   & (1\%)   & 6,5    & 6,7    & 7,0    & 7,7    \\
      PRES & 553  & (16\%) & 6    & (<1\%)  & 1017,8 & 1013,1 & 1008,7 & 1007,2 \\
      ATMP & 0    & (0\%)  & 3    & (<1\%)  & 11,5   & 9,9    & 7,8    & 7,4    \\
      WTMP & 0    & (0\%)  & 7    & (<1\%)  & 12,3   & 10,8   & 8,8    & 8,2    \\
      DEWP & 1189 & (33\%) & 2886 & (100\%) & 8,9    & 7,1    & 4,8    & 4,8    \\\hline
    \end{tabular}
    \caption{Datos perdidos y medias de atributos en entrenamiento por clase.}
    \label{tab:medias-por-clase}
\end{table}

Una vez reemplazados todos los datos perdidos se obtienen en el clasificador los resultados mostrados en la figura \ref{fig:clasificador-logistico-resultados-02b}, en los que se observa una mejora en las métricas del clasificador. Por ejemplo, el CCR sube casi un 3\%, la mínima sensibilidad aumenta ligeramente y el área bajo la curva ROC aumenta para tres de las cuatro clases.

\begin{figure}[ht]
    \centering
    \includegraphics[scale=0.8]{clasificador-logistico-resultados-03}
    \caption{Resultados tras reemplazar los datos perdidos}
    \label{fig:clasificador-logistico-resultados-02b}
\end{figure}


\subsection{Selección de características}


\subsection{Unificación de medidas}
Convertir ºC a ºK
Convertir HPas a Pas

\subsection{Normalización}


\subsection{Datos extremos}

